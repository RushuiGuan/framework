# Albatross.CommandLine
An integration library that provdes depedency injection, configuration and logging support for [System.CommandLine](https://learn.microsoft.com/en-us/dotnet/standard/commandline/) library.  It uses [Albatross.CommandLine.CodeGen](../Albatross.CommandLine.CodeGen/) to generate commands and options automatically while giving deveopers the flexibility to customize and leverage the capability of [System.CommandLine](https://learn.microsoft.com/en-us/dotnet/standard/commandline/) library.


## Features
* Dependency Injection enabled by [Code Generator](../Albatross.CommandLine.CodeGen/).
* Logging integration with Serilog provided by [Albatross.Logging](../../logging/Albatross.Logging/).
* Easy configuration setup provided by [Albatross.Config](../../config/Albatross.Config/).

## Related Articles
* [Conventions](../docs/conventions.md)
* [Global options](../docs/global-options.md)
* [Command Options](../docs/command-options.md)
* [Error Handling](../docs/error-handling.md)
* [Command Customization](../docs/command-customization.md)

## Quick Start ([Sample Program](../Sample.CommandLine/))
* Create a .net8 Console program
	* Make sure the `<Nullable>enable</Nullable>` option is enabled for the project.
* Reference [Albatross.CommandLine]() and [Albatross.CommandLine.CodeGen]() from nuget.
* Create a class `MySetup.cs` that inherits base class [Albatross.CommandLine.Setup](./Setup.cs)
	```csharp
	public class MySetup : Setup{
		protected override string RootCommandDescription => "Put Your Root Command Description Here";
		public override void RegisterServices(InvocationContext context, IConfiguration configuration, EnvironmentSetting envSetting, IServiceCollection services) {
			base.RegisterServices(context, configuration, envSetting, services);
			// RegisterCommands method is generated by codegen
			services.RegisterCommands();
			// register your services here.
			services.AddMyProxy();
		}
	}
	```
* Update the `program.cs` file
	```csharp
	internal class Program {
		static Task<int> Main(string[] args) =>
			new MySetup()
				.AddCommands()	// this method is generated by CodeGen
				.CommandBuilder
				.Build()
				.InvokeAsync(args);
	}
	```	
* Create a new class file `MyCommandHandler.cs` with the following code:
	```csharp
	[Verb("my-command", typeof(MyCommandHandler), Description = "My Test Command")]
	public record class MyCommandOptions {
		public string Name { get; set; } = string.Empty;
	}
	public class MyCommandHandler : ICommandHandler {
		private readonly ILogger logger;
		private readonly MyCommandOptions options;

		public MyCommandHandler(ILogger logger, IOptions<MyCommandOptions> options) {
			this.logger = logger;
			this.options = options.Value;
		}
		// this method is not used by System.CommandLine
		public int Invoke(InvocationContext context) => throw new System.NotSupportedException();
		public Task<int> InvokeAsync(InvocationContext context) {
			logger.LogInformation("Command {name }is invoked with parameter of {param}", context.ParsedCommandName(), options.Name);
			return Task.FromResult(0);
		}
	}
	```
* When the code above is saved, code generator will generate the code below automatically
	```csharp
	// MyCommand
	using System;
	using System.CommandLine;
	using System.IO;
	using System.Threading.Tasks;

	#nullable enable
	namespace Sample.CommandLine
	{
		public sealed partial class MyCommand : Command
		{
			public MyCommand() : base("my-command", null)
			{
				this.Option_Name = new Option<string>("--name", null)
				{
					IsRequired = true
				};
				this.AddOption(Option_Name);
			}

			public Option<string> Option_Name { get; }
		}
		public static class RegistrationExtensions
		{
			public static IServiceCollection RegisterCommands(this IServiceCollection services)
			{
				services.AddKeyedScoped<ICommandHandler, Sample.CommandLine.MyCommandHandler>("my-command");
				services.AddOptions<MyCommandOptions>().BindCommandLine();
				return services;
			}
		}
		public static Setup AddCommands(this Setup setup)
		{
			setup.AddCommand<MyCommand>();
			return setup;
		}
	}
	#nullable disable
	```
* We now have a functional command line program completed with dependency injection, logging and config setup.
